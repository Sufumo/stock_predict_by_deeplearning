 修改为每次训练时使用横截面数据，但并不是将全部86个行业一次性输入模型，采用每次局部训练的方式，即每个横截面随机选取几个中心点，并选取其一跳的邻居作为输入，其他的GAT节
点进行掩码，完全使用行业嵌入向量作为输入，对有输入的节点使用可学习门控机制混合节点和行业嵌入向量作为输入，并在训练时训练行业嵌入向量 
。同时训练时，并使用时间步计数器，当一个横截面的所有 86 个行业都抽完后才递增。 

 ● 关于中心节点的采样策略，您希望采用哪种方式？
   → 基于度数的采样（度数高的行业更容易被选为中心）
 ● 关于可学习门控机制的融合方式，您倾向于哪种？
   → 节点级门控（每个节点独立学习融合权重）
 ● 关于掩码节点（非中心且非邻居）的处理，您希望它们如何参与训练？
   → 保留但特征为纯嵌入（不参与损失计算）
 ● 关于时间步计数器和epoch定义，您希望如何组织？
   → 时间步优先：先遍历所有时间步（每步随机抽样），完整遍历后算一个epoch

Ready to submit your answers?

 1. 数据组织结构

 横截面数据：每个时间步包含所有86个行业的同步数据
 - 时间步总数：~900个（取决于数据长度）
 - 每个时间步：所有86个行业在同一时间窗口

 2. 训练流程

 Epoch循环:
   For 时间步 t in [0, 1, 2, ..., 899]:
     While 还有行业未被采样:
       1. 基于度数采样k个中心节点（如k=8-16）
       2. 获取中心节点的1-hop邻居
       3. 构建子图（中心+邻居+掩码节点）
       4. 节点特征填充：
          - 中心节点：门控融合（时间特征+嵌入）
          - 邻居节点：门控融合（时间特征+嵌入）
          - 掩码节点：纯嵌入
       5. GAT前向传播（所有86个节点）
       6. 只对中心+邻居计算预测损失
       7. 反向传播更新参数（包括嵌入）
     时间步计数器 += 1
   Epoch完成

5. 实施步骤

 阶段1：核心组件开发

 1. 创建 components/degree_sampler.py
   - 实现基于度数的采样器
   - 支持温度调节和排除已采样节点
 2. 创建 components/node_level_gate.py
   - 实现节点级门控MLP
   - 返回融合特征和门控值（用于可视化）
 3. 修改 components/model.py
   - 更新 __init__: 添加node_gate组件
   - 重写 _process_subgraph: 支持86节点完整图+掩码
   - 修改 forward: 接收node_mask参数

 阶段2：数据处理

 4. 修改 components/data_loader.py
   - 实现 CrossSectionalLocalDataset 类
   - 集成度数采样器
   - 实现时间步追踪逻辑
 5. 更新数据预处理
   - 确保 prepare_cross_sectional_data 正常工作
   - 添加行业度数预计算

 阶段3：训练流程

 6. 修改 components/trainer.py
   - 更新 train_epoch: 支持时间步追踪
   - 添加门控值记录（用于分析）
   - 修改验证逻辑（仍使用完整横截面）
 7. 更新 train.py
   - 添加横截面训练模式选择
   - 初始化新的数据集类
   - 传递node_mask等新参数

 阶段4：配置和文档

 8. 更新 config/default_config.yaml
   - 添加所有新配置项
   - 设置合理默认值
 9. 创建文档 CROSS_SECTIONAL_LOCAL_TRAINING.md
   - 详细说明新训练方式
   - 对比传统方法的优势
   - 参数调优指南
 10. 更新可视化工具
   - 添加门控值分布可视化
   - 添加时间步损失曲线
   - 添加采样覆盖率统计

    7. 预期效果

 优势

 ✅ 理论正确：横截面数据，GAT学习同一市场状态下的行业关系
 ✅ 训练效率：每批只处理12+邻居个节点的时间特征（约20-30个）
 ✅ 参数学习：行业嵌入通过GAT梯度持续更新
 ✅ 自适应融合：节点级门控让模型自主决定时间特征vs嵌入的权重
 ✅ 完整信息：GAT仍然在完整的86节点图上传播消息

 挑战

 ⚠️ 实现复杂度较高
 ⚠️ 需要仔细调试采样逻辑
 ⚠️ 门控机制增加参数量（但不多，约86*128个）

 8. 对比基线

 建议同时保留以下训练模式用于对比：
 1. 传统随机batch（当前）- Baseline
 2. 完整横截面（86个行业/batch）- 理论最优但慢
 3. 局部横截面（本方案）- 平衡理论和效率

 9. 估计工作量

 - 核心开发：2-3天
 - 调试测试：1-2天
 - 文档和可视化：1天
 - 总计：4-6天
