# KæŠ˜äº¤å‰éªŒè¯æ–­ç‚¹ç»­è®­æŒ‡å—

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

å½“KæŠ˜äº¤å‰éªŒè¯è®­ç»ƒè¿‡ç¨‹ä¸­æ–­æ—¶ï¼ˆä¾‹å¦‚fold 2å®Œæˆä½†fold 3ä¸­æ–­ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨æ–­ç‚¹ç»­è®­åŠŸèƒ½ä»æ–­ç‚¹å¤„ç»§ç»­è®­ç»ƒï¼Œé¿å…é‡å¤è®­ç»ƒå·²å®Œæˆçš„foldã€‚

## ğŸ¯ ä½¿ç”¨åœºæ™¯

**åœºæ™¯ç¤ºä¾‹**ï¼š
- âœ… Fold 1: å·²å®Œæˆï¼Œä¿å­˜äº† `fold_1_best.pth`
- âœ… Fold 2: å·²å®Œæˆï¼Œä¿å­˜äº† `fold_2_best.pth`
- âŒ Fold 3: è®­ç»ƒä¸­æ–­ï¼Œæœªå®Œæˆ

**è§£å†³æ–¹æ¡ˆ**ï¼šé‡æ–°è¿è¡Œè®­ç»ƒè„šæœ¬ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ï¼š
1. æ£€æµ‹å·²å®Œæˆçš„foldï¼ˆfold 1å’Œfold 2ï¼‰
2. è·³è¿‡å·²å®Œæˆçš„foldï¼Œç›´æ¥åŠ è½½å…¶ç»“æœ
3. ä»fold 3å¼€å§‹ç»§ç»­è®­ç»ƒ

## âš™ï¸ é…ç½®é€‰é¡¹

åœ¨ `config/default_config.yaml` ä¸­æœ‰ä¸¤ä¸ªç›¸å…³é…ç½®ï¼š

```yaml
training:
  # æ–­ç‚¹ç»­è®­é…ç½®
  resume_from_checkpoint: true   # æ˜¯å¦ä»checkpointæ¢å¤ï¼ˆè·³è¿‡å·²å®Œæˆçš„foldï¼‰
  load_previous_fold: false      # æ˜¯å¦ä»ä¸Šä¸€ä¸ªfoldçš„æ¨¡å‹ç»§ç»­è®­ç»ƒ
```

### é…ç½®è¯´æ˜

#### 1. `resume_from_checkpoint: true`ï¼ˆæ¨èï¼‰

**ä½œç”¨**ï¼š
- âœ… è‡ªåŠ¨æ£€æµ‹å·²å®Œæˆçš„fold
- âœ… è·³è¿‡å·²å®Œæˆçš„foldï¼Œç›´æ¥ä½¿ç”¨å…¶checkpointç»“æœ
- âœ… ä»æœªå®Œæˆçš„foldå¼€å§‹ç»§ç»­è®­ç»ƒ

**ä½¿ç”¨åœºæ™¯**ï¼š
- è®­ç»ƒä¸­æ–­åæ¢å¤è®­ç»ƒ
- æƒ³è¦è·³è¿‡æŸäº›å·²å®Œæˆçš„foldé‡æ–°è®­ç»ƒåç»­fold

**ç¤ºä¾‹**ï¼š
```yaml
resume_from_checkpoint: true
```
- å¦‚æœ `fold_1_best.pth` å’Œ `fold_2_best.pth` å­˜åœ¨ â†’ è·³è¿‡fold 1å’Œ2ï¼Œä»fold 3å¼€å§‹
- å¦‚æœæ‰€æœ‰foldéƒ½å·²å®Œæˆ â†’ ç›´æ¥åŠ è½½æ‰€æœ‰ç»“æœï¼Œä¸é‡æ–°è®­ç»ƒ

#### 2. `load_previous_fold: false`ï¼ˆé»˜è®¤ï¼‰

**ä½œç”¨**ï¼š
- `false`ï¼šæ¯æŠ˜é‡æ–°åˆå§‹åŒ–æ¨¡å‹å‚æ•°ï¼ˆç‹¬ç«‹è®­ç»ƒï¼‰
- `true`ï¼šä»ä¸Šä¸€ä¸ªfoldçš„checkpointåŠ è½½æ¨¡å‹å‚æ•°ï¼ˆè¿ç»­è®­ç»ƒï¼‰

**ä½¿ç”¨åœºæ™¯**ï¼š
- `false`ï¼ˆé»˜è®¤ï¼‰ï¼šæ ‡å‡†çš„KæŠ˜äº¤å‰éªŒè¯ï¼Œæ¯æŠ˜ç‹¬ç«‹è®­ç»ƒ
- `true`ï¼šå¸Œæœ›åˆ©ç”¨ä¸Šä¸€æŠ˜çš„çŸ¥è¯†ï¼Œå¯èƒ½æé«˜åç»­foldçš„è®­ç»ƒæ•ˆæœ

**æ³¨æ„**ï¼š
- è®¾ç½®ä¸º `true` æ—¶ï¼Œåç»­foldä¼šç»§æ‰¿ä¸Šä¸€foldçš„æ¨¡å‹æƒé‡
- è¿™å¯èƒ½ä¸ç¬¦åˆä¸¥æ ¼çš„KæŠ˜äº¤å‰éªŒè¯è¦æ±‚ï¼ˆæ¯æŠ˜åº”è¯¥ç‹¬ç«‹ï¼‰
- ä½†å¯èƒ½æœ‰åŠ©äºæé«˜è®­ç»ƒæ•ˆç‡

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### æ–¹æ³•1ï¼šä½¿ç”¨é»˜è®¤é…ç½®ï¼ˆæ¨èï¼‰

ç›´æ¥è¿è¡Œè®­ç»ƒè„šæœ¬ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹å¹¶è·³è¿‡å·²å®Œæˆçš„foldï¼š

```bash
python train.py
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
============================================================
Starting 3-Fold Time Series Cross-Validation
============================================================

âœ“ Found completed fold 1 checkpoint
âœ“ Found completed fold 2 checkpoint

ğŸ“‹ Resuming training: Found 2 completed fold(s): [1, 2]
   Will skip completed folds and continue from fold 3

------------------------------------------------------------
Fold 1/3 - SKIPPED (already completed)
------------------------------------------------------------
Fold 1 Results (from checkpoint):
  Val Loss: 1.6126
  Val Acc: 19.28%

------------------------------------------------------------
Fold 2/3 - SKIPPED (already completed)
------------------------------------------------------------
Fold 2 Results (from checkpoint):
  Val Loss: 1.6045
  Val Acc: 23.34%

------------------------------------------------------------
Fold 3/3
Train samples: 44252, Val samples: 11063
------------------------------------------------------------
Fold 3, Epoch 1/1
...
```

### æ–¹æ³•2ï¼šç¦ç”¨æ–­ç‚¹ç»­è®­

å¦‚æœæƒ³é‡æ–°è®­ç»ƒæ‰€æœ‰foldï¼ˆå¿½ç•¥å·²æœ‰checkpointï¼‰ï¼š

```yaml
# config/default_config.yaml
training:
  resume_from_checkpoint: false
```

ç„¶åè¿è¡Œï¼š
```bash
python train.py
```

### æ–¹æ³•3ï¼šä»ä¸Šä¸€foldç»§ç»­è®­ç»ƒ

å¦‚æœæƒ³åˆ©ç”¨ä¸Šä¸€foldçš„æ¨¡å‹æƒé‡ï¼š

```yaml
# config/default_config.yaml
training:
  resume_from_checkpoint: true
  load_previous_fold: true  # ä»ä¸Šä¸€foldåŠ è½½æ¨¡å‹
```

**æ³¨æ„**ï¼šè¿™ä¼šè®©fold 3ä»fold 2çš„æ¨¡å‹æƒé‡å¼€å§‹è®­ç»ƒï¼Œè€Œä¸æ˜¯é‡æ–°åˆå§‹åŒ–ã€‚

## ğŸ“ Checkpointæ–‡ä»¶ç»“æ„

æ¯ä¸ªfoldçš„checkpointæ–‡ä»¶åŒ…å«ï¼š

```python
{
    'fold': 2,                    # foldç¼–å·
    'epoch': 1,                   # æœ€ä½³epoch
    'model_state_dict': {...},    # æ¨¡å‹æƒé‡
    'optimizer_state_dict': {...}, # ä¼˜åŒ–å™¨çŠ¶æ€ï¼ˆæ–°å¢ï¼‰
    'val_metrics': {...},         # éªŒè¯æŒ‡æ ‡
    'best_val_acc': 23.34         # æœ€ä½³éªŒè¯å‡†ç¡®ç‡
}
```

## ğŸ” å·¥ä½œåŸç†

### 1. æ£€æµ‹å·²å®Œæˆçš„fold

è®­ç»ƒå¼€å§‹æ—¶ï¼Œç³»ç»Ÿä¼šæ‰«æ `save_dir` ç›®å½•ï¼š

```python
for fold_num in range(1, n_splits + 1):
    fold_checkpoint = f"fold_{fold_num}_best.pth"
    if os.path.exists(fold_checkpoint):
        # éªŒè¯checkpointå®Œæ•´æ€§
        checkpoint = torch.load(fold_checkpoint)
        if 'model_state_dict' in checkpoint:
            completed_folds.append(fold_num)
```

### 2. è·³è¿‡å·²å®Œæˆçš„fold

å¯¹äºå·²å®Œæˆçš„foldï¼š
- åŠ è½½checkpointä¸­çš„æ¨¡å‹å’ŒæŒ‡æ ‡
- ç›´æ¥ä½¿ç”¨checkpointä¸­çš„ç»“æœ
- ä¸é‡æ–°è®­ç»ƒ

### 3. ç»§ç»­è®­ç»ƒæœªå®Œæˆçš„fold

å¯¹äºæœªå®Œæˆçš„foldï¼š
- å¦‚æœ `load_previous_fold=True`ï¼šä»ä¸Šä¸€foldåŠ è½½æ¨¡å‹
- å¦‚æœ `load_previous_fold=False`ï¼šé‡æ–°åˆå§‹åŒ–æ¨¡å‹
- æ­£å¸¸è¿›è¡Œè®­ç»ƒ

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. Checkpointå®Œæ•´æ€§

ç³»ç»Ÿä¼šæ£€æŸ¥checkpointæ˜¯å¦åŒ…å«å¿…è¦çš„é”®ï¼š
- `model_state_dict`ï¼šæ¨¡å‹æƒé‡
- `val_metrics`ï¼šéªŒè¯æŒ‡æ ‡

å¦‚æœcheckpointæŸåæˆ–ä¸å®Œæ•´ï¼Œä¼šè·³è¿‡è¯¥foldå¹¶é‡æ–°è®­ç»ƒã€‚

### 2. é…ç½®ä¸€è‡´æ€§

**é‡è¦**ï¼šæ¢å¤è®­ç»ƒæ—¶ï¼Œç¡®ä¿ä»¥ä¸‹é…ç½®ä¸åŸå§‹è®­ç»ƒä¸€è‡´ï¼š
- `n_splits`ï¼šæŠ˜æ•°
- `min_train_size`ï¼šæœ€å°è®­ç»ƒé›†æ¯”ä¾‹
- `num_epochs`ï¼šæ¯æŠ˜è®­ç»ƒè½®æ•°
- `batch_size`ï¼šæ‰¹å¤§å°

**ä¸ä¸€è‡´çš„é…ç½®å¯èƒ½å¯¼è‡´**ï¼š
- æ•°æ®åˆ’åˆ†ä¸åŒ
- è®­ç»ƒè½®æ•°ä¸åŒ
- ç»“æœä¸å¯æ¯”è¾ƒ

### 3. æ¨¡å‹æ¶æ„ä¸€è‡´æ€§

æ¢å¤è®­ç»ƒæ—¶ï¼Œæ¨¡å‹æ¶æ„å¿…é¡»ä¸checkpointä¿å­˜æ—¶ä¸€è‡´ï¼š
- ç›¸åŒçš„æ¨¡å‹å‚æ•°ï¼ˆ`input_features`, `time_encoder_dim`ç­‰ï¼‰
- ç›¸åŒçš„æ¨¡å‹ç»“æ„

**å¦‚æœæ¨¡å‹æ¶æ„æ”¹å˜**ï¼š
- éœ€è¦åˆ é™¤æ—§çš„checkpointæ–‡ä»¶
- æˆ–è®¾ç½® `resume_from_checkpoint: false`

### 4. æ•°æ®ä¸€è‡´æ€§

ç¡®ä¿æ•°æ®æ–‡ä»¶æ²¡æœ‰å˜åŒ–ï¼š
- ç›¸åŒçš„æ•°æ®æ–‡ä»¶
- ç›¸åŒçš„æ•°æ®é¢„å¤„ç†
- ç›¸åŒçš„éšæœºç§å­ï¼ˆå¦‚æœä½¿ç”¨ï¼‰

## ğŸ› ï¸ æ•…éšœæ’é™¤

### é—®é¢˜1ï¼šCheckpointåŠ è½½å¤±è´¥

**é”™è¯¯ä¿¡æ¯**ï¼š
```
âš  Warning: Could not load fold X checkpoint: ...
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥checkpointæ–‡ä»¶æ˜¯å¦å­˜åœ¨ä¸”å®Œæ•´
2. æ£€æŸ¥æ–‡ä»¶æƒé™
3. å¦‚æœcheckpointæŸåï¼Œåˆ é™¤åé‡æ–°è®­ç»ƒ

### é—®é¢˜2ï¼šæ¨¡å‹æ¶æ„ä¸åŒ¹é…

**é”™è¯¯ä¿¡æ¯**ï¼š
```
RuntimeError: Error(s) in loading state_dict: ...
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®ä¿æ¨¡å‹é…ç½®ä¸checkpointä¿å­˜æ—¶ä¸€è‡´
2. æˆ–åˆ é™¤æ—§checkpointï¼Œé‡æ–°è®­ç»ƒ

### é—®é¢˜3ï¼šè·³è¿‡æ‰€æœ‰fold

**ç°è±¡**ï¼šæ‰€æœ‰foldéƒ½è¢«è·³è¿‡ï¼Œæ²¡æœ‰è®­ç»ƒ

**åŸå› **ï¼šæ‰€æœ‰foldçš„checkpointéƒ½å·²å­˜åœ¨

**è§£å†³æ–¹æ¡ˆ**ï¼š
- å¦‚æœæƒ³é‡æ–°è®­ç»ƒï¼šè®¾ç½® `resume_from_checkpoint: false`
- æˆ–åˆ é™¤ä¸éœ€è¦çš„checkpointæ–‡ä»¶

## ğŸ“Š ç¤ºä¾‹ï¼šå®Œæ•´è®­ç»ƒæµç¨‹

### ç¬¬ä¸€æ¬¡è¿è¡Œï¼ˆè®­ç»ƒfold 1-3ï¼‰

```bash
python train.py
```

**ç»“æœ**ï¼š
- âœ… Fold 1å®Œæˆ â†’ `fold_1_best.pth`
- âœ… Fold 2å®Œæˆ â†’ `fold_2_best.pth`
- âŒ Fold 3ä¸­æ–­ï¼ˆè®­ç»ƒåˆ°ä¸€åŠï¼‰

### ç¬¬äºŒæ¬¡è¿è¡Œï¼ˆæ¢å¤è®­ç»ƒï¼‰

```bash
python train.py
```

**ç³»ç»Ÿè¡Œä¸º**ï¼š
1. æ£€æµ‹åˆ° `fold_1_best.pth` å’Œ `fold_2_best.pth`
2. è·³è¿‡fold 1å’Œ2ï¼Œç›´æ¥ä½¿ç”¨å…¶ç»“æœ
3. ä»fold 3å¼€å§‹ç»§ç»­è®­ç»ƒ
4. å®Œæˆfold 3 â†’ `fold_3_best.pth`
5. ç”Ÿæˆæœ€ç»ˆæ±‡æ€»ç»“æœ

### æœ€ç»ˆç»“æœ

æ‰€æœ‰foldå®Œæˆåï¼Œç³»ç»Ÿä¼šï¼š
- é€‰æ‹©éªŒè¯å‡†ç¡®ç‡æœ€é«˜çš„foldä½œä¸º `best_model.pth`
- ç”ŸæˆKæŠ˜éªŒè¯æ±‡æ€»æŠ¥å‘Š
- ä¿å­˜å¯è§†åŒ–ç»“æœ

## ğŸ“ æœ€ä½³å®è·µ

1. **å®šæœŸä¿å­˜checkpoint**ï¼šæ¯ä¸ªfoldå®Œæˆåè‡ªåŠ¨ä¿å­˜
2. **ä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶**ï¼šä¸ºä¸åŒå®éªŒä½¿ç”¨ä¸åŒçš„save_dir
3. **è®°å½•é…ç½®**ï¼šä¿å­˜è®­ç»ƒæ—¶çš„é…ç½®æ–‡ä»¶
4. **éªŒè¯ç»“æœ**ï¼šæ¢å¤è®­ç»ƒåï¼Œæ£€æŸ¥ç»“æœæ˜¯å¦åˆç†
5. **å¤‡ä»½checkpoint**ï¼šé‡è¦å®éªŒçš„checkpointåº”è¯¥å¤‡ä»½

## ğŸ“ æ€»ç»“

æ–­ç‚¹ç»­è®­åŠŸèƒ½è®©KæŠ˜äº¤å‰éªŒè¯æ›´åŠ çµæ´»å’Œå¯é ï¼š

- âœ… **è‡ªåŠ¨æ£€æµ‹**ï¼šè‡ªåŠ¨å‘ç°å·²å®Œæˆçš„fold
- âœ… **æ™ºèƒ½è·³è¿‡**ï¼šè·³è¿‡å·²å®Œæˆfoldï¼ŒèŠ‚çœæ—¶é—´
- âœ… **çµæ´»é…ç½®**ï¼šå¯é€‰æ‹©æ˜¯å¦ä»ä¸Šä¸€foldç»§ç»­è®­ç»ƒ
- âœ… **ç»“æœä¸€è‡´**ï¼šä¿è¯ç»“æœçš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§

åªéœ€è¿è¡Œ `python train.py`ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å¤„ç†æ–­ç‚¹ç»­è®­ï¼

